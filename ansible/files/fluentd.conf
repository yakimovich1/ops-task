<source>
  @type tail
  path /fluentd/log/docker/*/*-json.log
  pos_file /fluentd/log/fluentd-docker.pos
  tag docker.*
  format json
  read_from_head true
  <parse>
    @type json
    time_key time
    time_type string
    time_format %Y-%m-%dT%H:%M:%S.%NZ
    keep_time_key true
  </parse>
</source>

<filter docker.**>
  @type record_transformer
  enable_ruby true
  <record>
    container_id ${record["container_id"]}
    container_name ${record["container_name"] || record["log"][/\/([a-zA-Z0-9\-_]+)\//, 1]}
  </record>
</filter>

<match docker.**>
  @type file
  path /fluentd/log/output/fluentd_output
  append true
  time_slice_format %Y-%m-%d_%H-%M
  time_slice_wait 1m
  compress gzip
  rotate_age 5
</match>

